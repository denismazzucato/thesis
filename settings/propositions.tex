
\newcommand*{\labprog}[1]{\label{lst:#1}}
\newcommand*{\labline}[1]{\label{line:#1}}

\newcommand*{\refprog}[1]{\hyperref[lst:#1]{\progname\xspace\ref{lst:#1}}}
\newcommand*{\vrefprog}[1]{\hyperref[lst:#1]{\progname\xspace\ref{lst:#1} \vpageref{lst:#1}}}
\newcommand*{\nrefprog}[1]{\hyperref[lst:#1]{\progname\xspace\ref{lst:#1} (\nameref{lst:#1})}}

\newcommand*{\refline}[1]{\hyperref[line:#1]{\linename\xspace\ref{line:#1}}}

\newcommand*{\refeqshorter}[1]{\hyperref[eq:#1]{\ref{eq:#1}}}

\newcommand*{\refdefshorter}[1]{\hyperref[def:#1]{\ref{def:#1}}}
\newcommand*{\nrefdef}[1]{\hyperref[def:#1]{\defname\xspace\ref{def:#1} (\nameref{def:#1})}}

\newcommandx{\siderefbox}[3][3=*1]{%
  \expandafter\marginnote[#3]{%
  \begin{named}[
    \ifcsname nref#1\endcsname
      {\csname nref#1\endcsname{#2}}
    \else
      {\csname ref#1\endcsname{#2}}
    \fi
  ]%
    \input{src/propositions/#2-short}%
  \end{named}%
}%
}

\newcommandx{\siderefboxandlabel}[3][3=*1]{%
\siderefbox{#1}{#2}[#3]
\csname ref#1\endcsname{#2}%
}

\newcommandx{\sidewithoutname}[3][3=*1]{%
\expandafter\marginnote[#3]{%
\begin{named}[{\csname ref#1\endcsname{#2}}]%
  \input{src/propositions/#2-short}%
\end{named}%
}%
\csname ref#1\endcsname{#2}%
}


% \newcommand*{\siderefdef}[1]{\side{def}{#1}}
% \newcommand*{\siderefeq}[1]{\side{eq}{#1}}
% \newcommand*{\siderefthm}[1]{\side{thm}{#1}}
% \WithSuffix\newcommand\refdef*[1]{\siderefdef{#1}}

\newcommandx{\siderefdef}[2][2=*1]{\siderefboxandlabel{def}{#1}[#2]}
\WithSuffix\newcommandx\refdef*[2][2=*1]{\siderefdef{#1}[#2]}
\newcommandx{\siderefassum}[2][2=*1]{\siderefboxandlabel{assum}{#1}[#2]}
\WithSuffix\newcommandx\refassum*[2][2=*1]{\siderefassum{#1}[#2]}
\newcommandx{\siderefthm}[2][2=*1]{\siderefboxandlabel{thm}{#1}[#2]}
\WithSuffix\newcommandx\refthm*[2][2=*1]{\siderefthm{#1}[#2]}
\newcommandx{\siderefprop}[2][2=*1]{\sidewithoutname{prop}{#1}[#2]}
\WithSuffix\newcommandx\refprop*[2][2=*1]{\siderefprop{#1}[#2]}
\newcommandx{\sidereflemma}[2][2=*1]{\siderefboxandlabel{lemma}{#1}[#2]}
\WithSuffix\newcommandx\reflemma*[2][2=*1]{\sidereflemma{#1}[#2]}
\newcommandx{\siderefremark}[2][2=*1]{\siderefboxandlabel{remark}{#1}[#2]}
\WithSuffix\newcommandx\refremark*[2][2=*1]{\siderefremark{#1}[#2]}
\newcommandx{\siderefexample}[2][2=*1]{\siderefboxandlabel{example}{#1}[#2]}
\WithSuffix\newcommandx\refexample*[2][2=*1]{\siderefexample{#1}[#2]}
\newcommandx{\siderefexercise}[2][2=*1]{\siderefboxandlabel{exercise}{#1}[#2]}
\WithSuffix\newcommandx\refexercise*[2][2=*1]{\siderefexercise{#1}[#2]}

\newcommandx{\siderefprog}[2][2=*1]{%
  \marginnote[#2]{%
  \begin{namedprog}[{\nrefprog{#1}}]~ %%% very important the space here
    \input{src/propositions/#1-short}%
  \end{namedprog}%
  }%
  \refprog{#1}%
}
\WithSuffix\newcommandx\refprog*[2][2=*1]{\siderefprog{#1}[#2]}


%%%%%%%%%%%%%%%%%

% definitions and side definitions
\newcommand*{\inputprop}[1]{\input{src/propositions/#1}}
\newcommand*{\marginprop}[1]{\marginnote{\input{src/propositions/#1-short}}}
